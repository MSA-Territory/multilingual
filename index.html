<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mombasa Data Debugger</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        #debug { background: #f5f5f5; padding: 15px; border-radius: 5px; margin-top: 20px; }
        .success { color: green; }
        .error { color: red; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
    </style>
</head>
<body>
    <h1>Mombasa Data Debugger</h1>
    <button onclick="loadData()">Reload Data</button>
    <div id="data-container"></div>
    <div id="debug">
        <h3>Debug Console</h3>
        <div id="debug-log"></div>
    </div>

    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // 1. Initialize Supabase - REPLACE THESE VALUES
        const supabaseUrl = 'https://jtqfbjatqlqhjkxjnixt.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp0cWZiamF0cWxxaGpreGpuaXh0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYxNDA2OTksImV4cCI6MjA2MTcxNjY5OX0.1VuFW1s8YAhZzu8chFHOV2jqT8ucgoNDKzsLQ3Ova_0';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);
        
        // Debug logging function
        function logDebug(message, isError = false) {
            const debugDiv = document.getElementById('debug-log');
            const logEntry = document.createElement('div');
            logEntry.className = isError ? 'error' : 'success';
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            debugDiv.prepend(logEntry);
        }

        // 2. Enhanced loadData function with debugging
        async function loadData() {
            logDebug("Starting data load...");
            
            try {
                // Clear previous data
                document.getElementById('data-container').innerHTML = '<p>Loading...</p>';
                
                // 3. Test connection first
                logDebug("Testing Supabase connection...");
                const { data: authData, error: authError } = await supabase.auth.getSession();
                
                if (authError) {
                    throw new Error(`Connection failed: ${authError.message}`);
                }
                logDebug("✓ Connected to Supabase successfully");
                
                // 4. Fetch data with debugging
                logDebug("Querying 'mombasa' table...");
                const { data, error, count } = await supabase
                    .from('mombasa')
                    .select('*', { count: 'exact' })
                    .order('created_at', { ascending: false });
                
                if (error) throw error;
                
                logDebug(`✓ Success! Found ${data.length} records`);
                
                // 5. Display data
                if (data.length > 0) {
                    const headers = Object.keys(data[0]);
                    let html = `
                        <table>
                            <thead><tr>${headers.map(h => `<th>${h}</th>`).join('')}</tr></thead>
                            <tbody>
                                ${data.map(row => `
                                    <tr>${headers.map(h => `<td>${row[h] !== null ? row[h] : 'NULL'}</td>`).join('')}</tr>
                                `).join('')}
                            </tbody>
                        </table>
                        <p>Total records: ${count}</p>
                    `;
                    document.getElementById('data-container').innerHTML = html;
                } else {
                    document.getElementById('data-container').innerHTML = '<p>No records found</p>';
                }
                
            } catch (err) {
                logDebug(`Error: ${err.message}`, true);
                document.getElementById('data-container').innerHTML = `
                    <p class="error">Error loading data: ${err.message}</p>
                    <p>Check the debug console below for details</p>
                `;
                console.error("Full error:", err);
            }
        }
        
        // Initial load
        loadData();
    </script>
</body>
</html>
