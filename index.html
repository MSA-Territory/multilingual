<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mombasa Data Viewer</title>
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        #debug { background: #f5f5f5; padding: 15px; border-radius: 5px; margin-top: 20px; }
        .success { color: green; }
        .error { color: red; }
    </style>
</head>
<body>
    <h1>Mombasa Data Viewer</h1>
    <div id="data-container">Loading...</div>
    <div id="debug">
        <h3>Debug Console</h3>
        <div id="debug-log"></div>
    </div>

    <!-- Load Supabase FIRST -->
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script>
        // 1. DEBUGGING INITIALIZATION
        function logDebug(message, isError = false) {
            const debugDiv = document.getElementById('debug-log');
            const logEntry = document.createElement('div');
            logEntry.className = isError ? 'error' : 'success';
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            debugDiv.prepend(logEntry);
        }

        // 2. SAFE SUPABASE INIT
        let supabase;
        try {
            logDebug("Initializing Supabase client...");
            
            supabase = supabase.createClient(
                'https://jtqfbjatqlqhjkxjnixt.supabase.co',  // ← REPLACE THIS
                'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imp0cWZiamF0cWxxaGpreGpuaXh0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDYxNDA2OTksImV4cCI6MjA2MTcxNjY5OX0.1VuFW1s8YAhZzu8chFHOV2jqT8ucgoNDKzsLQ3Ova_0'                 // ← REPLACE THIS
            );
            
            logDebug("✓ Supabase client initialized");
        } catch (initError) {
            logDebug(`Initialization failed: ${initError.message}`, true);
            document.getElementById('data-container').innerHTML = 
                `<p class="error">Failed to initialize Supabase: ${initError.message}</p>`;
            throw initError; // Stop execution
        }

        // 3. LOAD DATA ONLY AFTER INIT
        async function loadData() {
            if (!supabase) {
                const msg = "Supabase client not initialized";
                logDebug(msg, true);
                document.getElementById('data-container').innerHTML = 
                    `<p class="error">${msg}</p>`;
                return;
            }

            try {
                logDebug("Querying database...");
                const { data, error } = await supabase
                    .from('mombasa')
                    .select('*');

                if (error) throw error;
                
                document.getElementById('data-container').innerHTML = 
                    `<pre>${JSON.stringify(data, null, 2)}</pre>`;
                logDebug(`✓ Loaded ${data.length} records`);
                
            } catch (queryError) {
                logDebug(`Query failed: ${queryError.message}`, true);
                document.getElementById('data-container').innerHTML = 
                    `<p class="error">Data load failed: ${queryError.message}</p>`;
            }
        }

        // 4. START AFTER PAGE LOADS
        document.addEventListener('DOMContentLoaded', () => {
            logDebug("Page loaded, starting data load...");
            loadData();
        });
    </script>
</body>
</html>
